<!DOCTYPE html>
<html lang="pt">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Servi√ßos</title>
    <link rel="manifest"
        href="data:application/json;base64,eyJuYW1lIjoiU2VydmnDp29zIiwic2hvcnRfbmFtZSI6IlNlcnZpw6dvcyIsImRlc2NyaXB0aW9uIjoiR2VzdMOjbyBkZSBzZXJ2acOnb3MiLCJzdGFydF91cmwiOiIvIiwiZGlzcGxheSI6InN0YW5kYWxvbmUiLCJiYWNrZ3JvdW5kX2NvbG9yIjoiI2ZmZmZmZiIsInRoZW1lX2NvbG9yIjoiIzAwMDAwMCIsImljb25zIjpbeyJzcmMiOiJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSGRwWkhSb1BTSXlORElpSUdobGFXZG9kRDBpTWpReUlpQjJhV1YzUW05NFBTSXdJREFnTWpReUlESTBNaUkrUEhCaGRHZ2daRDBpVFRFeU1TQXpOUzQxWXpFdU1pMHVOemN4TFRFNE16QXROakl1TnpNNFNEZ3hOeTQxTVRJMVdUWjBNVGc0U0RneU5TNDROemN6UVRkemZERTNMalEzTURWNE1URmxOelV4TWpSb2VTNTJNVE0yTnlJZ1ptbHNiRDBpSXpBd01EQXdNQ0krUEM5d1lYUm9QaUE4TDNOMlp6ND0iLCJzaXplcyI6IjE5MngxOTIiLCJ0eXBlIjoiaW1hZ2Uvc3ZnK3htbCJ9XX0=">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Servi√ßos">

    <style>
        :root {
            --black: #000000;
            --gray-50: #fafafa;
            --gray-100: #f5f5f5;
            --gray-200: #e5e5e5;
            --gray-300: #d4d4d4;
            --gray-400: #a3a3a3;
            --gray-500: #737373;
            --gray-600: #525252;
            --gray-700: #404040;
            --gray-800: #262626;
            --gray-900: #171717;
            --white: #ffffff;
            --green: #10b981;
            --green-light: #ecfdf5;
            --green-dark: #047857;
            --amber: #f59e0b;
            --amber-light: #fffbeb;
            --amber-dark: #d97706;
            --blue: #3b82f6;
            --blue-light: #eff6ff;
            --blue-dark: #1d4ed8;
            --red: #ef4444;
            --red-light: #fef2f2;
            --purple: #8b5cf6;
            --purple-light: #f3f4f6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            color: var(--gray-900);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            min-height: 100vh;
        }

        .app-container {
            max-width: 428px;
            margin: 0 auto;
            background: var(--white);
            min-height: 100vh;
            box-shadow: 0 0 0 1px var(--gray-200), 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .header {
            background: linear-gradient(135deg, var(--black) 0%, var(--gray-800) 100%);
            color: var(--white);
            padding: 32px 24px 24px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="dots" width="20" height="20" patternUnits="userSpaceOnUse"><circle cx="10" cy="10" r="1" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23dots)"/></svg>');
            opacity: 0.3;
        }

        .header-content {
            position: relative;
            z-index: 1;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 6px;
            letter-spacing: -0.025em;
        }

        .header p {
            opacity: 0.8;
            font-size: 15px;
            font-weight: 400;
        }

        .connection-status {
            position: absolute;
            top: 24px;
            right: 24px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--red);
            transition: all 0.3s ease;
            z-index: 2;
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.3);
        }

        .connection-status.connected {
            background: var(--green);
        }

        .connection-status.connecting {
            background: var(--amber);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
                transform: scale(1);
            }

            50% {
                opacity: 0.7;
                transform: scale(1.2);
            }
        }

        .nav-tabs {
            display: flex;
            background: var(--white);
            border-bottom: 1px solid var(--gray-200);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .nav-tab {
            flex: 1;
            padding: 18px 12px;
            text-align: center;
            background: none;
            border: none;
            font-size: 14px;
            font-weight: 600;
            color: var(--gray-500);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .nav-tab:hover {
            color: var(--gray-900);
            background: var(--gray-50);
        }

        .nav-tab.active {
            color: var(--black);
            background: var(--gray-50);
        }

        .nav-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 32px;
            height: 3px;
            background: linear-gradient(90deg, var(--black), var(--gray-700));
            border-radius: 2px 2px 0 0;
        }

        .content {
            padding: 24px;
            min-height: calc(100vh - 200px);
            background: var(--gray-50);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(12px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .service-card {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 16px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .service-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--gray-300);
            transition: all 0.3s ease;
        }

        .service-card:hover {
            border-color: var(--gray-300);
            box-shadow: 0 8px 25px -5px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .service-card.paid::before {
            background: linear-gradient(180deg, var(--green), var(--green-dark));
        }

        .service-card.paid {
            background: linear-gradient(135deg, var(--white) 0%, var(--green-light) 100%);
            border-color: var(--green);
        }

        .service-card.unpaid::before {
            background: linear-gradient(180deg, var(--amber), var(--amber-dark));
        }

        .service-card.unpaid {
            background: linear-gradient(135deg, var(--white) 0%, var(--amber-light) 100%);
            border-color: var(--amber);
        }

        .service-card.pending::before {
            background: linear-gradient(180deg, var(--blue), var(--blue-dark));
        }

        .service-card.pending {
            background: linear-gradient(135deg, var(--white) 0%, var(--blue-light) 100%);
            border-color: var(--blue);
        }

        .service-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .service-date {
            font-weight: 700;
            color: var(--gray-900);
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .service-date::before {
            content: 'üìÖ';
            font-size: 16px;
        }

        .service-price {
            background: linear-gradient(135deg, var(--black), var(--gray-800));
            color: var(--white);
            padding: 8px 16px;
            border-radius: 12px;
            font-weight: 700;
            font-size: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .service-price::before {
            content: '‚Ç¨';
            font-size: 14px;
            opacity: 0.8;
        }

        .service-details {
            margin-bottom: 20px;
            space-y: 12px;
        }

        .service-detail {
            display: flex;
            align-items: flex-start;
            margin-bottom: 12px;
            font-size: 15px;
            color: var(--gray-600);
            gap: 12px;
        }

        .service-detail-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
            margin-top: 1px;
        }

        .service-detail-content {
            flex: 1;
        }

        .service-detail strong {
            color: var(--gray-900);
            font-weight: 600;
            margin-right: 8px;
        }

        .service-actions {
            display: flex;
            gap: 12px;
        }

        .btn {
            flex: 1;
            padding: 14px 20px;
            border: 1px solid var(--gray-300);
            border-radius: 12px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--white);
            color: var(--gray-700);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn:hover:not(:disabled) {
            border-color: var(--gray-400);
            background: var(--gray-50);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--black), var(--gray-800));
            color: var(--white);
            border-color: var(--black);
        }

        .btn-primary:hover:not(:disabled) {
            background: linear-gradient(135deg, var(--gray-800), var(--gray-700));
            border-color: var(--gray-800);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--green), var(--green-dark));
            color: var(--white);
            border-color: var(--green);
        }

        .btn-success:hover:not(:disabled) {
            background: linear-gradient(135deg, var(--green-dark), #065f46);
            border-color: var(--green-dark);
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-paid {
            background: var(--green-light);
            color: var(--green-dark);
            border: 1px solid var(--green);
        }

        .status-unpaid {
            background: var(--amber-light);
            color: var(--amber-dark);
            border: 1px solid var(--amber);
        }

        .status-pending {
            background: var(--blue-light);
            color: var(--blue-dark);
            border: 1px solid var(--blue);
        }

        .floating-btn {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, var(--black), var(--gray-800));
            border: none;
            border-radius: 50%;
            color: var(--white);
            font-size: 28px;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .floating-btn:hover {
            background: linear-gradient(135deg, var(--gray-800), var(--gray-700));
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.25);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 2000;
            padding: 20px;
            backdrop-filter: blur(8px);
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background: var(--white);
            border-radius: 20px;
            padding: 32px;
            width: 100%;
            max-width: 420px;
            max-height: 85vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            animation: slideUp 0.4s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            margin-bottom: 24px;
            text-align: center;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 6px;
        }

        .modal-subtitle {
            color: var(--gray-500);
            font-size: 14px;
        }

        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--gray-100);
            border: none;
            font-size: 20px;
            color: var(--gray-500);
            cursor: pointer;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .close-btn:hover {
            background: var(--gray-200);
            color: var(--gray-700);
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--gray-700);
            font-size: 14px;
        }

        .form-control {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            font-size: 15px;
            transition: all 0.3s ease;
            background: var(--gray-50);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--black);
            background: var(--white);
            box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.1);
        }

        .textarea {
            min-height: 140px;
            resize: vertical;
            font-family: inherit;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 24px;
        }

        .summary-card {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .summary-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--purple), var(--blue));
        }

        .summary-card:hover {
            border-color: var(--gray-300);
            box-shadow: 0 8px 25px -5px rgba(0, 0, 0, 0.1);
            transform: translateY(-4px);
        }

        .summary-value {
            font-size: 28px;
            font-weight: 800;
            color: var(--gray-900);
            margin-bottom: 8px;
        }

        .summary-label {
            font-size: 12px;
            color: var(--gray-500);
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 1px;
        }

        .loading {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid var(--gray-200);
            border-top: 3px solid var(--black);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .message {
            position: fixed;
            top: 24px;
            left: 20px;
            right: 20px;
            max-width: 388px;
            margin: 0 auto;
            padding: 16px 20px;
            border-radius: 12px;
            font-weight: 600;
            z-index: 3000;
            animation: slideDown 0.4s ease;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        @keyframes slideDown {
            from {
                transform: translateY(-100%) scale(0.95);
                opacity: 0;
            }

            to {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        .message.success {
            background: linear-gradient(135deg, var(--green-light), #d1fae5);
            color: var(--green-dark);
            border: 2px solid var(--green);
        }

        .message.error {
            background: linear-gradient(135deg, var(--red-light), #fee2e2);
            color: #991b1b;
            border: 2px solid var(--red);
        }

        .message.warning {
            background: linear-gradient(135deg, var(--amber-light), #fef3c7);
            color: var(--amber-dark);
            border: 2px solid var(--amber);
        }

        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: var(--gray-500);
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.6;
        }

        .empty-state h3 {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--gray-700);
        }

        /* Month sections for realizados */
        .month-section {
            margin-bottom: 32px;
            background: var(--white);
            border-radius: 16px;
            border: 1px solid var(--gray-200);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .month-section:hover {
            border-color: var(--gray-300);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .month-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            background: linear-gradient(135deg, var(--gray-50), var(--white));
            border-bottom: 1px solid var(--gray-200);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .month-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--purple), var(--blue));
        }

        .month-header:hover {
            background: linear-gradient(135deg, var(--gray-100), var(--gray-50));
        }

        .month-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--gray-900);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .month-title::before {
            content: 'üìä';
            font-size: 16px;
        }

        .month-stats {
            display: flex;
            align-items: center;
            gap: 16px;
            font-size: 14px;
            color: var(--gray-600);
            font-weight: 500;
        }

        .month-stat {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .month-toggle {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--gray-200);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            color: var(--gray-600);
        }

        .month-toggle:hover {
            background: var(--gray-300);
            color: var(--gray-800);
        }

        .month-content {
            padding: 0 24px 24px;
            overflow: hidden;
            transition: all 0.4s ease;
        }

        .month-content.collapsed {
            max-height: 0;
            padding: 0 24px;
            opacity: 0;
        }

        .month-content.expanded {
            max-height: 5000px;
            opacity: 1;
        }

        .debug-panel {
            position: fixed;
            bottom: 100px;
            right: 24px;
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: 12px;
            padding: 16px;
            font-size: 12px;
            max-width: 240px;
            display: none;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .debug-panel.show {
            display: block;
            animation: slideUp 0.3s ease;
        }

        .debug-toggle {
            position: fixed;
            bottom: 100px;
            left: 24px;
            background: var(--gray-700);
            color: var(--white);
            border: none;
            border-radius: 8px;
            padding: 10px 16px;
            font-size: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .debug-toggle:hover {
            background: var(--gray-800);
            transform: translateY(-2px);
        }

        @media (max-width: 640px) {
            .summary-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .service-actions {
                flex-direction: column;
                gap: 12px;
            }

            .content {
                padding: 16px;
            }

            .header {
                padding: 24px 16px 20px;
            }

            .month-header {
                padding: 16px 20px;
            }

            .month-content {
                padding: 0 20px 20px;
            }

            .month-content.collapsed {
                padding: 0 20px;
            }

            .month-stats {
                flex-direction: column;
                gap: 8px;
                align-items: flex-end;
            }
        }

        .summary-icon {
            font-size: 32px;
            margin-bottom: 12px;
        }

        .pendentes-card::before {
            background: linear-gradient(90deg, var(--blue), var(--blue-dark));
        }

        .pendentes-card {
            border-color: var(--blue);
            background: linear-gradient(135deg, var(--white) 0%, var(--blue-light) 100%);
        }

        .realizados-card::before {
            background: linear-gradient(90deg, var(--purple), #7c3aed);
        }

        .realizados-card {
            border-color: var(--purple);
            background: linear-gradient(135deg, var(--white) 0%, var(--purple-light) 100%);
        }

        .pagos-card::before {
            background: linear-gradient(90deg, var(--green), var(--green-dark));
        }

        .pagos-card {
            border-color: var(--green);
            background: linear-gradient(135deg, var(--white) 0%, var(--green-light) 100%);
        }

        .por-receber-card::before {
            background: linear-gradient(90deg, var(--amber), var(--amber-dark));
        }

        .por-receber-card {
            border-color: var(--amber);
            background: linear-gradient(135deg, var(--white) 0%, var(--amber-light) 100%);
        }

        .total-geral-card {
            background: linear-gradient(135deg, var(--black), var(--gray-800));
            color: var(--white);
            border-radius: 20px;
            padding: 32px;
            text-align: center;
            margin-top: 24px;
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }

        .total-geral-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="dots2" width="20" height="20" patternUnits="userSpaceOnUse"><circle cx="10" cy="10" r="1" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23dots2)"/></svg>');
            opacity: 0.3;
        }

        .total-geral-card>* {
            position: relative;
            z-index: 1;
        }

        .total-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .total-geral-card h3 {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 12px;
            opacity: 0.9;
        }

        .total-value {
            font-size: 36px;
            font-weight: 800;
            letter-spacing: -0.025em;
        }

        \`\`\` .month-total {
            display: flex;
            align-items: center;
            gap: 6px;
            background: linear-gradient(135deg, var(--green), var(--green-dark));
            color: var(--white);
            padding: 6px 12px;
            border-radius: 8px;
            font-weight: 700;
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
        }

        .month-total-value {
            font-size: 16px;
            font-weight: 800;
        }
    </style>
</head>

<body>
    <div class="app-container">
        <header class="header">
            <div class="connection-status" id="connectionStatus" title="Status da conex√£o"></div>
            <div class="header-content">
                <h1>Servi√ßos</h1>
                <p>Gest√£o profissional e elegante</p>
            </div>
        </header>

        <nav class="nav-tabs">
            <button class="nav-tab active" data-tab="pendentes">Pendentes</button>
            <button class="nav-tab" data-tab="realizados">Realizados</button>
            <button class="nav-tab" data-tab="resumo">Resumo</button>
        </nav>

        <main class="content">
            <div id="pendentes" class="tab-content active">
                <div id="pendentes-list">
                    <div style="text-align: center; padding: 60px 20px;">
                        <div class="loading"></div>
                        <p style="margin-top: 16px; color: var(--gray-500); font-weight: 500;">Carregando servi√ßos...
                        </p>
                    </div>
                </div>
            </div>

            <div id="realizados" class="tab-content">
                <div id="realizados-list"></div>
            </div>

            <div id="resumo" class="tab-content">
                <div id="resumo-content"></div>
            </div>
        </main>

        <button class="floating-btn" onclick="showAddModal()" title="Adicionar servi√ßo">+</button>
        <button class="debug-toggle" onclick="toggleDebug()">Debug</button>
    </div>

    <div id="debugPanel" class="debug-panel">
        <div style="font-weight: 700; margin-bottom: 12px; color: var(--gray-900);">üîß Debug Info</div>
        <div><strong>Backend:</strong></div>
        <div id="debugBackend" style="font-size: 10px; word-break: break-all; margin-bottom: 8px;">-</div>
        <div><strong>√öltima tentativa:</strong></div>
        <div id="debugLastTry" style="margin-bottom: 8px;">-</div>
        <div><strong>Erro:</strong></div>
        <div id="debugError" style="color: var(--red); font-weight: 500;">-</div>
    </div>

    <div id="addModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="hideAddModal()">&times;</button>
            <div class="modal-header">
                <h2 class="modal-title">‚ú® Adicionar Servi√ßo</h2>
                <p class="modal-subtitle">Cole a mensagem do WhatsApp com os detalhes</p>
            </div>
            <form id="addServiceForm">
                <div class="form-group">
                    <label class="form-label" for="mensagem">üì± Mensagem do WhatsApp</label>
                    <textarea id="mensagem" class="form-control textarea"
                        placeholder="Cole aqui a mensagem completa do WhatsApp com data, hora, local, servi√ßos e pre√ßo..."
                        required></textarea>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;" id="submitBtn">
                    ‚ú® Adicionar Servi√ßo
                </button>
            </form>
        </div>
    </div>

    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="hideSettingsModal()">&times;</button>
            <div class="modal-header">
                <h2 class="modal-title">‚öôÔ∏è Configura√ß√µes</h2>
                <p class="modal-subtitle">Configure a conex√£o com o backend</p>
            </div>
            <div class="form-group">
                <label class="form-label" for="backendUrl">üåê URL do Backend</label>
                <input type="url" id="backendUrl" class="form-control" placeholder="https://seu-backend.com">
            </div>
            <div style="display: flex; gap: 12px;">
                <button class="btn btn-primary" onclick="saveSettings()">üíæ Salvar</button>
                <button class="btn" onclick="testConnection()">üîç Testar</button>
                <button class="btn" onclick="resetSettings()">üîÑ Reset</button>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const DEFAULT_API_BASE = 'https://servicos-backend-3jyq.onrender.com';
        let API_BASE = localStorage.getItem('api_base') || DEFAULT_API_BASE;

        // Global state
        let currentTab = 'pendentes';
        let connectionStatus = 'disconnected';
        let debugMode = false;
        let lastError = null;
        let collapsedMonths = new Set();

        // Initialize app
        document.addEventListener('DOMContentLoaded', function () {
            setupEventListeners();
            checkConnection();
            loadData();
        });

        function setupEventListeners() {
            // Tab navigation
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', function () {
                    const tabName = this.dataset.tab;
                    switchTab(tabName);
                });
            });

            // Form submission
            document.getElementById('addServiceForm').addEventListener('submit', handleAddService);

            // Modal close events
            document.getElementById('addModal').addEventListener('click', function (e) {
                if (e.target === e.currentTarget) hideAddModal();
            });

            document.getElementById('settingsModal').addEventListener('click', function (e) {
                if (e.target === e.currentTarget) hideSettingsModal();
            });

            // ESC key to close modals
            document.addEventListener('keydown', function (e) {
                if (e.key === 'Escape') {
                    hideAddModal();
                    hideSettingsModal();
                }
            });

            // Double click header to show settings
            document.querySelector('.header').addEventListener('dblclick', showSettingsModal);
        }

        function updateConnectionStatus(status) {
            connectionStatus = status;
            const statusEl = document.getElementById('connectionStatus');
            statusEl.className = `connection-status ${status}`;

            const titles = {
                connected: 'üü¢ Conectado ao backend',
                connecting: 'üü° Conectando...',
                disconnected: 'üî¥ Desconectado do backend'
            };
            statusEl.title = titles[status] || 'Status desconhecido';

            updateDebugPanel();
        }

        function updateDebugPanel() {
            if (!debugMode) return;

            document.getElementById('debugBackend').textContent = API_BASE;
            document.getElementById('debugLastTry').textContent = new Date().toLocaleTimeString();
            document.getElementById('debugError').textContent = lastError || '-';
        }

        function toggleDebug() {
            debugMode = !debugMode;
            document.getElementById('debugPanel').classList.toggle('show', debugMode);
            if (debugMode) updateDebugPanel();
        }

        async function checkConnection() {
            updateConnectionStatus('connecting');

            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 10000);

                const response = await fetch(`${API_BASE}/health`, {
                    method: 'GET',
                    signal: controller.signal,
                    headers: {
                        'Accept': 'application/json',
                    }
                });

                clearTimeout(timeoutId);

                if (response.ok) {
                    updateConnectionStatus('connected');
                    lastError = null;
                    return true;
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                updateConnectionStatus('disconnected');
                lastError = error.message;
                console.error('Connection check failed:', error);
                return false;
            }
        }

        function switchTab(tabName) {
            // Update nav tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

            // Update content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');

            currentTab = tabName;
            loadData();
        }

        function loadData() {
            switch (currentTab) {
                case 'pendentes':
                    loadPendentes();
                    break;
                case 'realizados':
                    loadRealizados();
                    break;
                case 'resumo':
                    loadResumo();
                    break;
            }
        }

        async function apiCall(endpoint, options = {}) {
            try {
                updateConnectionStatus('connecting');

                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 30000);

                const response = await fetch(`${API_BASE}${endpoint}`, {
                    signal: controller.signal,
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                        ...options.headers
                    },
                    ...options
                });

                clearTimeout(timeoutId);

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorText || response.statusText}`);
                }

                updateConnectionStatus('connected');
                lastError = null;

                const data = await response.json();
                return data;

            } catch (error) {
                updateConnectionStatus('disconnected');
                lastError = error.message;
                console.error('API Error:', error);

                if (error.name === 'AbortError') {
                    throw new Error('Timeout na requisi√ß√£o');
                } else if (error.message.includes('Failed to fetch')) {
                    throw new Error('N√£o foi poss√≠vel conectar ao servidor');
                } else {
                    throw error;
                }
            }
        }

        async function loadPendentes() {
            const listElement = document.getElementById('pendentes-list');
            listElement.innerHTML = '<div style="text-align: center; padding: 60px 20px;"><div class="loading"></div><p style="margin-top: 16px; color: var(--gray-500); font-weight: 500;">Carregando servi√ßos...</p></div>';

            try {
                const servicos = await apiCall('/pendentes');
                renderServicos(servicos, 'pendentes-list', false);
            } catch (error) {
                listElement.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">‚ö†Ô∏è</div>
                        <h3>Erro ao carregar</h3>
                        <p>N√£o foi poss√≠vel carregar os servi√ßos pendentes</p>
                        <p style="font-size: 12px; margin-top: 8px; color: var(--red);">${error.message}</p>
                        <button class="btn btn-primary" onclick="loadPendentes()" style="margin-top: 20px;">
                            üîÑ Tentar novamente
                        </button>
                    </div>
                `;
            }
        }

        async function loadRealizados() {
            const listElement = document.getElementById('realizados-list');
            listElement.innerHTML = '<div style="text-align: center; padding: 60px 20px;"><div class="loading"></div><p style="margin-top: 16px; color: var(--gray-500); font-weight: 500;">Carregando servi√ßos...</p></div>';

            try {
                const servicos = await apiCall('/realizados');
                console.log('Servi√ßos realizados recebidos:', servicos); // Debug
                renderRealizadosByMonth(servicos, 'realizados-list');
            } catch (error) {
                listElement.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">‚ö†Ô∏è</div>
                        <h3>Erro ao carregar</h3>
                        <p>N√£o foi poss√≠vel carregar os servi√ßos realizados</p>
                        <p style="font-size: 12px; margin-top: 8px; color: var(--red);">${error.message}</p>
                        <button class="btn btn-primary" onclick="loadRealizados()" style="margin-top: 20px;">
                            üîÑ Tentar novamente
                        </button>
                    </div>
                `;
            }
        }

        async function loadResumo() {
            const container = document.getElementById('resumo-content');
            container.innerHTML = '<div style="text-align: center; padding: 60px 20px;"><div class="loading"></div><p style="margin-top: 16px; color: var(--gray-500); font-weight: 500;">Carregando resumo...</p></div>';

            try {
                const resumo = await apiCall('/resumo');
                renderResumo(resumo);
            } catch (error) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">‚ö†Ô∏è</div>
                        <h3>Erro ao carregar</h3>
                        <p>N√£o foi poss√≠vel carregar o resumo</p>
                        <p style="font-size: 12px; margin-top: 8px; color: var(--red);">${error.message}</p>
                        <button class="btn btn-primary" onclick="loadResumo()" style="margin-top: 20px;">
                            üîÑ Tentar novamente
                        </button>
                    </div>
                `;
            }
        }

        function parseDate(dateString) {
            console.log('Parsing date:', dateString); // Debug

            // Format: DD-MM-YYYY (with hyphens)
            if (dateString.includes('-')) {
                const parts = dateString.split('-');
                if (parts.length === 3) {
                    const day = parseInt(parts[0]);
                    const month = parseInt(parts[1]) - 1; // Month is 0-indexed
                    const year = parseInt(parts[2]);

                    console.log(`Parsed: day=${day}, month=${month + 1}, year=${year}`); // Debug

                    if (year > 1900 && month >= 0 && month <= 11 && day >= 1 && day <= 31) {
                        const parsedDate = new Date(year, month, day);
                        console.log('Final parsed date:', parsedDate); // Debug
                        return parsedDate;
                    }
                }
            }

            // Format: DD/MM/YY or DD/MM/YYYY (with slashes)
            if (dateString.includes('/')) {
                const parts = dateString.split('/');
                if (parts.length === 3) {
                    const day = parseInt(parts[0]);
                    const month = parseInt(parts[1]) - 1; // Month is 0-indexed
                    let year = parseInt(parts[2]);

                    // Handle 2-digit years (YY format)
                    if (year < 100) {
                        // Assume years 00-30 are 2000-2030, and 31-99 are 1931-1999
                        if (year <= 30) {
                            year += 2000;
                        } else {
                            year += 1900;
                        }
                    }

                    console.log(`Parsed: day=${day}, month=${month + 1}, year=${year}`); // Debug

                    if (year > 1900 && month >= 0 && month <= 11 && day >= 1 && day <= 31) {
                        const parsedDate = new Date(year, month, day);
                        console.log('Final parsed date:', parsedDate); // Debug
                        return parsedDate;
                    }
                }
            }

            // Format: YYYY-MM-DD (ISO format)
            if (dateString.match(/^\d{4}-\d{2}-\d{2}$/)) {
                const date = new Date(dateString);
                if (!isNaN(date.getTime())) {
                    return date;
                }
            }

            // Fallback: try to parse as is
            const date = new Date(dateString);
            if (!isNaN(date.getTime())) {
                return date;
            }

            console.warn('Could not parse date:', dateString);
            return new Date(); // Return current date as fallback
        }

        function renderResumo(resumo) {
            const container = document.getElementById('resumo-content');

            const resumoHtml = `
        <div class="summary-grid">
            <div class="summary-card pendentes-card">
                <div class="summary-icon">‚è±Ô∏è</div>
                <div class="summary-value">‚Ç¨${resumo.total_pendentes.toFixed(2)}</div>
                <div class="summary-label">Pendentes</div>
            </div>
            <div class="summary-card realizados-card">
                <div class="summary-icon">‚úÖ</div>
                <div class="summary-value">‚Ç¨${resumo.total_realizados.toFixed(2)}</div>
                <div class="summary-label">Realizados</div>
            </div>
            <div class="summary-card pagos-card">
                <div class="summary-icon">üí∞</div>
                <div class="summary-value">‚Ç¨${resumo.total_pagos.toFixed(2)}</div>
                <div class="summary-label">Pagos</div>
            </div>
            <div class="summary-card por-receber-card">
                <div class="summary-icon">üìã</div>
                <div class="summary-value">‚Ç¨${resumo.total_por_receber.toFixed(2)}</div>
                <div class="summary-label">Por Receber</div>
            </div>
        </div>
        
        <div class="total-geral-card">
            <div class="total-icon">üíé</div>
            <h3>Total Geral</h3>
            <div class="total-value">‚Ç¨${resumo.total_geral.toFixed(2)}</div>
        </div>
    `;

            container.innerHTML = resumoHtml;
        }

        function renderServicos(servicos, containerId, isRealizado) {
            const container = document.getElementById(containerId);

            if (!servicos || servicos.length === 0) {
                const emptyTitle = isRealizado ? 'Nenhum servi√ßo realizado' : 'Nenhum servi√ßo pendente';
                const emptyDesc = isRealizado ? 'Os servi√ßos realizados aparecer√£o aqui' : 'Os servi√ßos pendentes aparecer√£o aqui';

                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üìã</div>
                        <h3>${emptyTitle}</h3>
                        <p>${emptyDesc}</p>
                    </div>
                `;
                return;
            }

            const servicosHtml = servicos.map(servico => {
                let cardClass = 'service-card';
                let statusBadge = '';

                if (isRealizado) {
                    if (servico.pago) {
                        cardClass += ' paid';
                        statusBadge = '<span class="status-badge status-paid">‚úÖ Pago</span>';
                    } else {
                        cardClass += ' unpaid';
                        statusBadge = '<span class="status-badge status-unpaid">üí∞ N√£o Pago</span>';
                    }
                } else {
                    cardClass += ' pending';
                    statusBadge = '<span class="status-badge status-pending">‚è±Ô∏è Pendente</span>';
                }

                return `
                    <div class="${cardClass}">
                        <div class="service-header">
                            <div class="service-date">${servico.data}</div>
                            <div class="service-price">${servico.preco.toFixed(2)}</div>
                        </div>
                        <div class="service-details">
                            <div class="service-detail">
                                <div class="service-detail-icon">üìç</div>
                                <div class="service-detail-content">
                                    <strong>Local:</strong> ${servico.local}
                                </div>
                            </div>
                            <div class="service-detail">
                                <div class="service-detail-icon">üïê</div>
                                <div class="service-detail-content">
                                    <strong>Hora:</strong> ${servico.hora}
                                </div>
                            </div>
                            <div class="service-detail">
                                <div class="service-detail-icon">üõ†Ô∏è</div>
                                <div class="service-detail-content">
                                    <strong>Servi√ßos:</strong> ${Array.isArray(servico.subcategorias) ? servico.subcategorias.join(', ') : servico.subcategorias}
                                </div>
                            </div>
                            ${statusBadge}
                        </div>
                        <div class="service-actions">
                            ${!isRealizado ? `
                                <button class="btn btn-primary" onclick="marcarRealizado(${servico.id})">
                                    ‚úÖ Marcar Realizado
                                </button>
                            ` : `
                                ${!servico.pago ? `
                                    <button class="btn btn-success" onclick="marcarPago(${servico.id})">
                                        üí∞ Marcar Pago
                                    </button>
                                ` : `
                                    <button class="btn" disabled>
                                        ‚úÖ Pago
                                    </button>
                                `}
                            `}
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = servicosHtml;
        }

        function renderRealizadosByMonth(servicos, containerId) {
            const container = document.getElementById(containerId);

            if (!servicos || servicos.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üìã</div>
                        <h3>Nenhum servi√ßo realizado</h3>
                        <p>Os servi√ßos realizados aparecer√£o aqui organizados por m√™s</p>
                    </div>
                `;
                return;
            }

            console.log('Organizando servi√ßos por m√™s...'); // Debug

            // Group services by month
            const servicesByMonth = {};
            servicos.forEach((servico, index) => {
                console.log(`Servi√ßo ${index}:`, servico); // Debug

                const date = parseDate(servico.data);
                const monthKey = date.toLocaleDateString('pt-PT', {
                    year: 'numeric',
                    month: 'long'
                }).replace(/^./, str => str.toUpperCase()); // Capitalize first letter

                console.log(`Data original: ${servico.data}, Data parseada: ${date}, Chave do m√™s: ${monthKey}`); // Debug

                if (!servicesByMonth[monthKey]) {
                    servicesByMonth[monthKey] = {
                        services: [],
                        total: 0,
                        paid: 0,
                        unpaid: 0,
                        count: 0,
                        date: date // Store date for sorting
                    };
                }

                servicesByMonth[monthKey].services.push(servico);
                servicesByMonth[monthKey].total += servico.preco;
                servicesByMonth[monthKey].count++;

                if (servico.pago) {
                    servicesByMonth[monthKey].paid += servico.preco;
                } else {
                    servicesByMonth[monthKey].unpaid += servico.preco;
                }
            });

            console.log('Servi√ßos agrupados por m√™s:', servicesByMonth); // Debug

            // Sort months by date (most recent first)
            const sortedMonths = Object.keys(servicesByMonth).sort((a, b) => {
                return servicesByMonth[b].date - servicesByMonth[a].date;
            });

            console.log('Meses ordenados:', sortedMonths); // Debug

            let html = '';
            sortedMonths.forEach(month => {
                const monthData = servicesByMonth[month];
                const isCollapsed = collapsedMonths.has(month);

                html += `
    <div class="month-section">
        <div class="month-header" onclick="toggleMonth('${month}')">
            <div class="month-title">${month}</div>
            <div class="month-stats">
                <div class="month-stat">
                    <span>üìä</span>
                    <span>${monthData.count} servi√ßos</span>
                </div>
                <div class="month-total">
                    <span>üí∞</span>
                    <span class="month-total-value">‚Ç¨${monthData.total.toFixed(2)}</span>
                </div>
                <div class="month-toggle">${isCollapsed ? '+' : '‚àí'}</div>
            </div>
        </div>
        <div class="month-content ${isCollapsed ? 'collapsed' : 'expanded'}">
`;

                // Sort services within month by date (most recent first)
                const sortedServices = monthData.services.sort((a, b) => {
                    const dateA = parseDate(a.data);
                    const dateB = parseDate(b.data);
                    return dateB - dateA;
                });

                sortedServices.forEach(servico => {
                    let cardClass = 'service-card';
                    let statusBadge = '';

                    if (servico.pago) {
                        cardClass += ' paid';
                        statusBadge = '<span class="status-badge status-paid">‚úÖ Pago</span>';
                    } else {
                        cardClass += ' unpaid';
                        statusBadge = '<span class="status-badge status-unpaid">üí∞ N√£o Pago</span>';
                    }

                    html += `
                        <div class="${cardClass}">
                            <div class="service-header">
                                <div class="service-date">${servico.data}</div>
                                <div class="service-price">${servico.preco.toFixed(2)}</div>
                            </div>
                            <div class="service-details">
                                <div class="service-detail">
                                    <div class="service-detail-icon">üìç</div>
                                    <div class="service-detail-content">
                                        <strong>Local:</strong> ${servico.local}
                                    </div>
                                </div>
                                <div class="service-detail">
                                    <div class="service-detail-icon">üïê</div>
                                    <div class="service-detail-content">
                                        <strong>Hora:</strong> ${servico.hora}
                                    </div>
                                </div>
                                <div class="service-detail">
                                    <div class="service-detail-icon">üõ†Ô∏è</div>
                                    <div class="service-detail-content">
                                        <strong>Servi√ßos:</strong> ${Array.isArray(servico.subcategorias) ? servico.subcategorias.join(', ') : servico.subcategorias}
                                    </div>
                                </div>
                                ${statusBadge}
                            </div>
                            <div class="service-actions">
                                ${!servico.pago ? `
                                    <button class="btn btn-success" onclick="marcarPago(${servico.id})">
                                        üí∞ Marcar Pago
                                    </button>
                                ` : `
                                    <button class="btn" disabled>
                                        ‚úÖ Pago
                                    </button>
                                `}
                            </div>
                        </div>
                    `;
                });

                html += `
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function toggleMonth(month) {
            if (collapsedMonths.has(month)) {
                collapsedMonths.delete(month);
            } else {
                collapsedMonths.add(month);
            }

            // Update UI immediately without reloading
            const monthContent = document.querySelector(`[onclick="toggleMonth('${month}')"]`).nextElementSibling;
            const monthToggle = document.querySelector(`[onclick="toggleMonth('${month}')"] .month-toggle`);

            if (collapsedMonths.has(month)) {
                monthContent.classList.remove('expanded');
                monthContent.classList.add('collapsed');
                monthToggle.textContent = '+';
            } else {
                monthContent.classList.remove('collapsed');
                monthContent.classList.add('expanded');
                monthToggle.textContent = '‚àí';
            }
        }

        async function handleAddService(e) {
            e.preventDefault();

            const submitBtn = document.getElementById('submitBtn');
            const mensagem = document.getElementById('mensagem').value;

            if (!mensagem.trim()) {
                showMessage('üìù Por favor, insira a mensagem do WhatsApp', 'error');
                return;
            }

            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span class="loading"></span> Adicionando...';

            try {
                await apiCall('/adicionar_servico', {
                    method: 'POST',
                    body: JSON.stringify({ mensagem: mensagem })
                });

                showMessage('‚ú® Servi√ßo adicionado com sucesso!', 'success');
                hideAddModal();

                if (currentTab === 'pendentes') {
                    loadPendentes();
                }
            } catch (error) {
                showMessage(`‚ùå Erro ao adicionar servi√ßo: ${error.message}`, 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = '‚ú® Adicionar Servi√ßo';
            }
        }

        async function marcarRealizado(id) {
            try {
                await apiCall(`/marcar_como_realizado/${id}`, {
                    method: 'POST'
                });

                showMessage('‚úÖ Servi√ßo marcado como realizado!', 'success');
                loadPendentes();
            } catch (error) {
                showMessage(`‚ùå Erro ao marcar como realizado: ${error.message}`, 'error');
            }
        }

        async function marcarPago(id) {
            try {
                await apiCall(`/marcar_como_pago/${id}`, {
                    method: 'POST'
                });

                showMessage('üí∞ Servi√ßo marcado como pago!', 'success');
                loadRealizados();
            } catch (error) {
                showMessage(`‚ùå Erro ao marcar como pago: ${error.message}`, 'error');
            }
        }

        function showAddModal() {
            document.getElementById('addModal').classList.add('show');
            document.body.style.overflow = 'hidden';
            setTimeout(() => document.getElementById('mensagem').focus(), 300);
        }

        function hideAddModal() {
            document.getElementById('addModal').classList.remove('show');
            document.body.style.overflow = 'auto';
            document.getElementById('mensagem').value = '';
        }

        function showSettingsModal() {
            document.getElementById('backendUrl').value = API_BASE;
            document.getElementById('settingsModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function hideSettingsModal() {
            document.getElementById('settingsModal').classList.remove('show');
            document.body.style.overflow = 'auto';
        }

        function saveSettings() {
            const newUrl = document.getElementById('backendUrl').value.trim();
            if (newUrl) {
                API_BASE = newUrl.replace(/\/$/, '');
                localStorage.setItem('api_base', API_BASE);
                showMessage('üíæ Configura√ß√µes salvas!', 'success');
                hideSettingsModal();
                checkConnection();
            }
        }

        async function testConnection() {
            const newUrl = document.getElementById('backendUrl').value.trim();
            if (!newUrl) {
                showMessage('üîç Digite uma URL v√°lida', 'error');
                return;
            }

            const oldUrl = API_BASE;
            API_BASE = newUrl.replace(/\/$/, '');

            const connected = await checkConnection();
            if (connected) {
                showMessage('üü¢ Conex√£o bem-sucedida!', 'success');
            } else {
                API_BASE = oldUrl;
                showMessage('üî¥ Falha na conex√£o', 'error');
            }
        }

        function resetSettings() {
            API_BASE = DEFAULT_API_BASE;
            localStorage.removeItem('api_base');
            document.getElementById('backendUrl').value = API_BASE;
            showMessage('üîÑ Configura√ß√µes resetadas!', 'success');
            checkConnection();
        }

        function showMessage(message, type) {
            const existingMessages = document.querySelectorAll('.message');
            existingMessages.forEach(msg => msg.remove());

            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.textContent = message;

            document.body.appendChild(messageDiv);

            setTimeout(() => {
                messageDiv.remove();
            }, 5000);
        }

        // Auto-refresh connection status
        setInterval(checkConnection, 60000);

        // PWA Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(() => console.log('Service Worker registrado com sucesso!'))
                    .catch(err => console.log('Falha ao registrar Service Worker:', err));
            });
        }
    </script>
</body>

</html>